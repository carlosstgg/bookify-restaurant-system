<div class="inventory-container">
  <div class="header-actions">
    <h1>Inventory Management</h1>
    <button class="btn-primary" (click)="openCreate()">
      <lucide-icon [img]="PlusIcon" size="18"></lucide-icon>
      <span>Add Ingredient</span>
    </button>
  </div>

  <div class="table-card">
    <table class="data-table">
      <thead>
        <tr>
          <th>Name</th>
          <th>Stock Level</th>
          <th>Unit</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let item of items()">
          <td class="name-cell">
            <div class="icon-circle">
               <lucide-icon [img]="PackageIcon" size="18"></lucide-icon>
            </div>
            {{ item.item_name }}
          </td>
          <td class="stock-cell">
            <div class="progress-bar-container">
               <div class="val">{{ item.quantity }}</div>
               <!-- Simple visual bar, max assumed 100 for visual relative scale or just logic -->
               <div class="bar-bg">
                 <div 
                  class="bar-fill" 
                  [style.width.%]="(item.quantity / (item.min_quantity || 1) * 30) > 100 ? 100 : (item.quantity / (item.min_quantity || 1) * 30)"
                  [class.low]="isLowStock(item)"
                 ></div>
               </div>
            </div>
          </td>
          <td>{{ item.unit }}</td>
          <td>
            <span class="status-badge" [class.warning]="isLowStock(item)" [class.ok]="!isLowStock(item)">
              <lucide-icon *ngIf="isLowStock(item)" [img]="AlertIcon" size="14"></lucide-icon>
              {{ isLowStock(item) ? 'Low Stock' : 'In Stock' }}
            </span>
          </td>
          <td class="actions-cell">
            <button class="btn-icon" (click)="openEdit(item)">
              <lucide-icon [img]="EditIcon" size="18"></lucide-icon>
            </button>
            <button class="btn-icon delete" (click)="deleteItem(item.inventory_id)">
              <lucide-icon [img]="DeleteIcon" size="18"></lucide-icon>
            </button>
          </td>
        </tr>
        <tr *ngIf="items().length === 0">
          <td colspan="5" class="empty-state">No ingredients found. Add one to start tracking stock.</td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<app-modal
  *ngIf="showModal()"
  [title]="editingItem() ? 'Edit Ingredient' : 'Add New Ingredient'"
  (closed)="showModal.set(false)"
>
  <form [formGroup]="form" (ngSubmit)="save()" class="crud-form">
    <div class="form-group">
      <label>Item Name</label>
      <input type="text" formControlName="item_name" placeholder="e.g. Tomato Sauce">
    </div>

    <div class="form-row">
      <div class="form-group">
        <label>Quantity</label>
        <input type="number" formControlName="quantity">
      </div>
      <div class="form-group">
        <label>Unit</label>
        <select formControlName="unit">
            <option value="unit">Units (pcs)</option>
            <option value="kg">Kilograms (kg)</option>
            <option value="g">Grams (g)</option>
            <option value="l">Liters (l)</option>
            <option value="ml">Milliliters (ml)</option>
        </select>
      </div>
    </div>

     <div class="form-group">
      <label>Min Quantity (Alert Threshold)</label>
      <input type="number" formControlName="min_quantity">
      <small>System will double check availability before taking orders.</small>
    </div>

    <div class="modal-actions">
      <button type="button" class="btn-cancel" (click)="showModal.set(false)">Cancel</button>
      <button type="submit" class="btn-primary" [disabled]="form.invalid">Save Stock</button>
    </div>
  </form>
</app-modal>
